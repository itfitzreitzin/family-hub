<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Hub - Household Coordination System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .header h1 {
            font-size: 2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-badges {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .status-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        .status-badge.active {
            background: #48bb78;
        }
        
        .tab-nav {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .tab-nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            color: #4a5568;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: #f7fafc;
        }
        
        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f7fafc;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .card h3 {
            color: #4a5568;
            margin-bottom: 15px;
        }
        
        /* Dashboard Specific */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
        }
        
        .dashboard-card h3 {
            color: white;
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .dashboard-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .dashboard-card .subtitle {
            font-size: 0.85em;
            opacity: 0.8;
        }
        
        .today-schedule {
            background: #f8fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .schedule-timeline {
            position: relative;
            padding-left: 40px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 20px;
            border-left: 2px solid #e2e8f0;
            padding-left: 20px;
        }
        
        .timeline-item:last-child {
            border-left: none;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -7px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            border: 2px solid #667eea;
        }
        
        .timeline-item.current::before {
            background: #48bb78;
            border-color: #48bb78;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .timer-active {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .timeline-time {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .timeline-content {
            color: #4a5568;
        }
        
        .timeline-who {
            display: inline-block;
            padding: 2px 8px;
            background: #edf2f7;
            border-radius: 12px;
            font-size: 0.85em;
            margin-left: 10px;
        }
        
        /* Schedule Coordinator */
        .calendar-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: 100px repeat(5, 1fr);
            gap: 10px;
            min-width: 700px;
        }
        
        .calendar-header {
            font-weight: bold;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            text-align: center;
        }
        
        .calendar-label {
            font-weight: bold;
            padding: 10px;
            color: #4a5568;
        }
        
        .calendar-cell {
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
            min-height: 60px;
            position: relative;
        }
        
        .calendar-cell.busy {
            background: #fed7d7;
            border: 1px solid #fc8181;
        }
        
        .calendar-cell.available {
            background: #c6f6d5;
            border: 1px solid #48bb78;
        }
        
        .calendar-cell.partial {
            background: #fef5e7;
            border: 1px solid #f6ad55;
        }
        
        .calendar-cell.nanny-suggested {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
        }
        
        .coverage-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 1.2em;
        }
        
        /* Nanny Tracker */
        .time-tracker {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #48bb78;
            color: white;
        }
        
        .btn-danger {
            background: #f56565;
            color: white;
        }
        
        .btn-warning {
            background: #ed8936;
            color: white;
        }
        
        .btn-large {
            padding: 20px 40px;
            font-size: 1.2em;
        }
        
        /* Activity Tracker */
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .activity-item .activity-info {
            flex: 1;
        }
        
        .activity-item .activity-time {
            color: #667eea;
            font-weight: bold;
        }
        
        .activity-item .activity-name {
            font-size: 1.1em;
            color: #2d3748;
            margin: 5px 0;
        }
        
        .activity-item .activity-details {
            color: #718096;
            font-size: 0.9em;
        }
        
        .activity-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .activity-status.upcoming {
            background: #e6f7ff;
            color: #1890ff;
        }
        
        .activity-status.ongoing {
            background: #d4f4dd;
            color: #52c41a;
        }
        
        .activity-status.completed {
            background: #f0f0f0;
            color: #8c8c8c;
        }
        
        /* Forms */
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            color: #4a5568;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .input-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        /* Equity Tracker */
        .equity-bar {
            display: flex;
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .equity-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .equity-you {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .equity-partner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .equity-legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 10px;
        }
        
        .equity-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        /* AI Suggestions */
        .ai-suggestion {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .ai-suggestion h3 {
            color: #92400e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-suggestion ul {
            margin-left: 20px;
            color: #78350f;
        }
        
        .ai-suggestion li {
            margin: 8px 0;
        }
        
        .suggestion-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        /* Notifications */
        .notification-settings {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
        }
        
        .notification-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .notification-option:last-child {
            border-bottom: none;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #cbd5e0;
            border-radius: 24px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #48bb78;
        }
        
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
        }
        
        .toggle-switch.active::after {
            transform: translateX(26px);
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f7fafc;
            padding: 12px;
            text-align: left;
            color: #4a5568;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .status-badges {
                margin-top: 15px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .calendar-grid {
                grid-template-columns: 80px repeat(5, 1fr);
            }
            
            .tab-nav-content {
                justify-content: flex-start;
            }
        }
        
        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Quick Actions */
        .quick-actions {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .fab.mini {
            width: 40px;
            height: 40px;
            font-size: 18px;
        }
        
        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .alert-info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #0050b3;
        }
        
        .alert-success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #135200;
        }
        
        .alert-warning {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            color: #ad6800;
        }
        
        .alert-danger {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #a8071a;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-btn {
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
        }
        
        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üè† Family Hub</h1>
            <div class="status-badges">
                <div class="status-badge active">
                    <span id="userRoleDisplay">üë§ Loading...</span>
                </div>
                <div class="status-badge">
                    <span>üë∂ Nanny: Off</span>
                </div>
                <div class="status-badge">
                    <span>üìÖ Week 47</span>
                </div>
            </div>
        </div>
    </div>
    
    <nav class="tab-nav">
        <div class="tab-nav-content">
            <button class="tab-btn active" onclick="switchTab('dashboard', event)">
                <span>üìä</span> Dashboard
            </button>
            <button class="tab-btn" onclick="switchTab('schedule', event)">
                <span>üìÖ</span> Schedule Coordinator
            </button>
            <button class="tab-btn" onclick="switchTab('nanny', event)">
                <span>‚è∞</span> Nanny Tracker
            </button>
            <button class="tab-btn" onclick="switchTab('activities', event)">
                <span>üéØ</span> Activities
            </button>
            <button class="tab-btn equity-tab-btn" onclick="switchTab('equity', event)">
                <span>‚öñÔ∏è</span> Parent Equity
            </button>
            <button class="tab-btn settings-tab-btn" onclick="switchTab('settings', event)">
                <span>‚öôÔ∏è</span> Settings
            </button>
        </div>
    </nav>
    
    <div class="container">
        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content active">
            <div class="alert alert-info">
                <span>üí°</span>
                <span><strong>Good morning!</strong> You have 2 meetings today. Nanny arrives at 9am. Rhea takes over at 5pm.</span>
            </div>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>This Week's Coverage</h3>
                    <div class="value">87%</div>
                    <div class="subtitle">3 gaps to address</div>
                </div>
                <div class="dashboard-card parent-balance-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h3>Parent Balance</h3>
                    <div class="value">52/48</div>
                    <div class="subtitle">You / Rhea</div>
                </div>
                <div class="dashboard-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <h3>Nanny Hours</h3>
                    <div class="value">32.5</div>
                    <div class="subtitle">This week</div>
                </div>
                <div class="dashboard-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <h3>Next Handoff</h3>
                    <div class="value">5:00 PM</div>
                    <div class="subtitle">Rhea takes over</div>
                </div>
            </div>
            
            <div class="card">
                <h2>üìÖ Today's Schedule</h2>
                <div class="today-schedule">
                    <div class="schedule-timeline">
                        <div class="timeline-item">
                            <div class="timeline-time">8:00 AM</div>
                            <div class="timeline-content">
                                Morning routine
                                <span class="timeline-who">You</span>
                            </div>
                        </div>
                        <div class="timeline-item current">
                            <div class="timeline-time">9:00 AM</div>
                            <div class="timeline-content">
                                Nanny arrives
                                <span class="timeline-who">Sarah</span>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">10:00 AM</div>
                            <div class="timeline-content">
                                Your team standup
                                <span class="timeline-who">Meeting</span>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">12:00 PM</div>
                            <div class="timeline-content">
                                Kids lunch & nap
                                <span class="timeline-who">Sarah</span>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">2:00 PM</div>
                            <div class="timeline-content">
                                Rhea's client call
                                <span class="timeline-who">Rhea Busy</span>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">4:00 PM</div>
                            <div class="timeline-content">
                                Soccer practice
                                <span class="timeline-who">Activity</span>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">5:00 PM</div>
                            <div class="timeline-content">
                                Nanny leaves - Handoff
                                <span class="timeline-who">Rhea</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>‚ö° Quick Actions</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary">Request Coverage</button>
                    <button class="btn btn-success">Log Activity</button>
                    <button class="btn btn-warning">Update Schedule</button>
                    <button class="btn btn-danger">Emergency Contact</button>
                </div>
            </div>
        </div>
        
        <!-- Schedule Coordinator Tab -->
        <div id="schedule-tab" class="tab-content">
            <div class="card">
                <h2>üóìÔ∏è Weekly Schedule Overview</h2>
                <p style="color: #718096; margin-bottom: 20px;">
                    Layered view of all calendars. Green = covered, Red = gap, Yellow = partial coverage
                </p>
                
                <div class="calendar-container">
                    <div class="calendar-grid">
                        <div class="calendar-header">Time</div>
                        <div class="calendar-header">Monday</div>
                        <div class="calendar-header">Tuesday</div>
                        <div class="calendar-header">Wednesday</div>
                        <div class="calendar-header">Thursday</div>
                        <div class="calendar-header">Friday</div>
                        
                        <div class="calendar-label">You</div>
                        <div class="calendar-cell busy">Meeting 10-12</div>
                        <div class="calendar-cell available">Free</div>
                        <div class="calendar-cell busy">Deep work 9-2</div>
                        <div class="calendar-cell partial">Call at 3pm</div>
                        <div class="calendar-cell available">WFH</div>
                        
                        <div class="calendar-label">Rhea</div>
                        <div class="calendar-cell available">Free AM</div>
                        <div class="calendar-cell busy">Client 10-3</div>
                        <div class="calendar-cell available">Free</div>
                        <div class="calendar-cell busy">Workshop</div>
                        <div class="calendar-cell partial">Busy AM</div>
                        
                        <div class="calendar-label">Nanny</div>
                        <div class="calendar-cell nanny-suggested">9am-5pm ‚úì</div>
                        <div class="calendar-cell nanny-suggested">9am-6pm ‚úì</div>
                        <div class="calendar-cell nanny-suggested">9am-3pm ‚úì</div>
                        <div class="calendar-cell">Off</div>
                        <div class="calendar-cell nanny-suggested">10am-2pm ‚úì</div>
                        
                        <div class="calendar-label">Kids</div>
                        <div class="calendar-cell">School</div>
                        <div class="calendar-cell partial">Soccer 4pm</div>
                        <div class="calendar-cell">School</div>
                        <div class="calendar-cell partial">Music 5pm</div>
                        <div class="calendar-cell">School</div>
                        
                        <div class="calendar-label">Coverage</div>
                        <div class="calendar-cell available">
                            <span class="coverage-indicator">‚úÖ</span>
                        </div>
                        <div class="calendar-cell available">
                            <span class="coverage-indicator">‚úÖ</span>
                        </div>
                        <div class="calendar-cell available">
                            <span class="coverage-indicator">‚úÖ</span>
                        </div>
                        <div class="calendar-cell partial">
                            <span class="coverage-indicator">‚ö†Ô∏è</span>
                        </div>
                        <div class="calendar-cell partial">
                            <span class="coverage-indicator">‚ö†Ô∏è</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="ai-suggestion">
                <h3>ü§ñ AI Schedule Optimization</h3>
                <p style="margin-bottom: 15px;">Based on your calendars, here's the optimal nanny schedule for next week:</p>
                <ul>
                    <li><strong>Monday:</strong> 9am-5pm (both parents have morning meetings)</li>
                    <li><strong>Tuesday:</strong> 9am-6pm (extended for soccer practice + Rhea's client)</li>
                    <li><strong>Wednesday:</strong> 9am-3pm (you're both free after 3)</li>
                    <li><strong>Thursday:</strong> Skip or 2-5pm only (light day, save money)</li>
                    <li><strong>Friday:</strong> 10am-2pm (just covering Rhea's morning)</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Estimated cost:</strong> $600 (30 hours √ó $20/hr)</p>
                <p><strong>Savings:</strong> $160 vs full-time coverage</p>
                <div class="suggestion-actions">
                    <button class="btn btn-primary">Accept & Schedule</button>
                    <button class="btn btn-warning">Adjust Hours</button>
                    <button class="btn">Dismiss</button>
                </div>
            </div>
        </div>
        
        <!-- Nanny Tracker Tab -->
        <div id="nanny-tab" class="tab-content">
            <div class="card">
                <h2>‚è∞ Time Tracking</h2>
                
                <!-- Live Timer Display -->
                <div style="text-align: center; margin: 20px 0;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                color: white; 
                                padding: 30px; 
                                border-radius: 15px; 
                                box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">
                            CURRENT SHIFT
                        </div>
                        <div id="liveTimer" style="font-size: 3.5em; font-weight: bold; font-family: 'SF Mono', Monaco, monospace;">
                            00:00:00
                        </div>
                        <div id="clockInTime" style="font-size: 0.9em; opacity: 0.9; margin-top: 10px;">
                            Not clocked in
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 30px 0;">
                    <button id="clockInBtn" class="btn btn-success btn-large" onclick="clockIn()">Clock In</button>
                    <button id="clockOutBtn" class="btn btn-danger btn-large" onclick="clockOut()" style="display: none;">Clock Out</button>
                </div>
                <div class="time-tracker">
                    <button class="btn btn-warning">Manual Entry</button>
                    <button class="btn btn-primary">View History</button>
                </div>
            </div>
            
            <div class="card">
                <h2>üìä This Week's Summary</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Clock In</th>
                            <th>Clock Out</th>
                            <th>Hours</th>
                            <th>Earnings</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Mon 11/18</td>
                            <td>9:00 AM</td>
                            <td>5:00 PM</td>
                            <td>8.0</td>
                            <td>$160</td>
                            <td>Regular day</td>
                        </tr>
                        <tr>
                            <td>Tue 11/19</td>
                            <td>9:00 AM</td>
                            <td>6:00 PM</td>
                            <td>9.0</td>
                            <td>$180</td>
                            <td>Stayed for soccer</td>
                        </tr>
                    </tbody>
                </table>
                <div class="payment-summary" style="text-align: center; margin-top: 20px;">
                    <div id="weeklyTotal" style="font-size: 2em; color: #667eea; margin: 10px 0;">
  Total: $0.00 (0.0 hours)
</div>
                    <button class="btn btn-primary btn-large family-only" onclick="generateVenmoPayment()">
  Generate Venmo Payment
</button>
                </div>
            </div>
        </div>
        
        <!-- Activities Tab -->
        <div id="activities-tab" class="tab-content">
            <div class="card">
                <h2>üéØ Kids' Activities</h2>
                <button class="btn btn-primary" style="margin-bottom: 20px;">+ Add Activity</button>
                
                <ul class="activity-list">
                    <li class="activity-item">
                        <div class="activity-info">
                            <div class="activity-time">Tuesday 4:00 PM</div>
                            <div class="activity-name">Soccer Practice</div>
                            <div class="activity-details">
                                Location: Community Park | Coach: Mike | Bring: Water, cleats
                            </div>
                        </div>
                        <span class="activity-status upcoming">Tomorrow</span>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Parent Equity Tab -->
        <div id="equity-tab" class="tab-content">
            <div class="card">
                <h2>‚öñÔ∏è Parent Coverage Balance</h2>
                <h3>This Week</h3>
                <div class="equity-bar">
                    <div class="equity-segment equity-you" style="width: 52%;">You: 52%</div>
                    <div class="equity-segment equity-partner" style="width: 48%;">Rhea: 48%</div>
                </div>
                <div class="equity-legend">
                    <div class="equity-legend-item">
                        <div class="legend-color equity-you"></div>
                        <span>You: 18.2 hours</span>
                    </div>
                    <div class="equity-legend-item">
                        <div class="legend-color equity-partner"></div>
                        <span>Rhea: 16.8 hours</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <div class="card">
                <h2>‚öôÔ∏è System Settings</h2>
                <div class="form-row">
                    <div class="input-group">
                        <label>Nanny Name</label>
                        <input type="text" value="Sarah" id="nannyName">
                    </div>
                    <div class="input-group">
                        <label>Hourly Rate</label>
                        <input type="number" value="20" id="hourlyRate">
                    </div>
                    <div class="input-group">
                        <label>Venmo Username</label>
                        <input type="text" placeholder="@username" id="venmoUsername">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
            
            <div class="card">
                <h2>üîß Technical Settings</h2>
                <div class="input-group">
                    <label>Google Script URL</label>
                    <input type="text" id="scriptUrlSetting" placeholder="https://script.google.com/macros/s/..." style="width: 100%;">
                    <small style="color: #666;">Your Google Apps Script deployment URL</small>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label>Your Name</label>
                        <input type="text" id="yourNameSetting" placeholder="Your name">
                    </div>
                    <div class="input-group">
                        <label>Partner's Name</label>
                        <input type="text" id="partnerNameSetting" placeholder="Partner's name">
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveAllSettings()">Update All Settings</button>
            </div>
        </div>
    </div>
    
    <!-- Quick Action Button -->
    <div class="quick-actions">
        <button class="fab" onclick="showQuickAdd()">+</button>
    </div>
    
    <script>
        const fmtUSD = n => new Intl.NumberFormat('en-US', { style:'currency', currency:'USD' }).format(Number(n) || 0);
const sanitizeVenmo = h => (h || '').toString().trim().replace(/^@+/, '');
        // ===== CONFIGURATION - UPDATE THESE VALUES =====
        // ===== CONFIGURATION - HARDCODE YOUR SCRIPT URL HERE =====
const CONFIG = {
    // THIS IS THE ONLY THING YOU NEED TO HARDCODE
    scriptUrl: 'https://script.google.com/macros/s/AKfycbz0D5lzPKspVmhzhliFK26yzTrtUMaATAmxJOLf4nlPM78TwRe8II7cQi6C6VVGS5AFsQ/exec',
    
    // Everything else loads from Google Sheets
    nannyName: '',
    hourlyRate: 20,
    yourName: '',
    partnerName: '',
    venmoUsername: '',
    familyPIN: '1234',
    userRole: null
};

// ===== NO MORE LOCALSTORAGE - EVERYTHING FROM SHEETS =====
async function initializeApp() {
    // 1. Determine role from URL
    const urlParams = new URLSearchParams(window.location.search);
    const role = urlParams.get('role');
    const setupKey = urlParams.get('setup');
    
    // Set role based on URL
    if (setupKey === 'admin123') {
        CONFIG.userRole = 'admin';
    } else if (role === 'nanny') {
        CONFIG.userRole = 'nanny';
    } else if (role === 'family') {
        CONFIG.userRole = 'family';
    } else {
        // No role in URL - show selection
        showRoleSelection();
        return;
    }
    
    // 2. Apply role restrictions immediately
    applyRoleRestrictions();
    
    // 3. Load settings from Google Sheets (not localStorage!)
    try {
        const settings = await callGoogleScript('getSettings');
        
        if (settings && settings.configured) {
            // Apply settings from Sheets
            CONFIG.nannyName = settings.nannyName || 'Nanny';
            CONFIG.hourlyRate = parseFloat(settings.hourlyRate) || 20;
            CONFIG.yourName = settings.yourName || 'Parent 1';
            CONFIG.partnerName = settings.partnerName || 'Parent 2';
            CONFIG.venmoUsername = settings.venmoUsername || '';
            CONFIG.familyPIN = settings.familyPIN || '1234';
            
            console.log('‚úÖ Settings loaded from Google Sheets');
        } else {
            // No settings in Sheets yet
            if (CONFIG.userRole === 'admin') {
                showSetupWizard();
                return;
            } else {
                console.log('Waiting for admin to configure settings');
            }
        }
    } catch (error) {
        console.error('Error loading settings:', error);
    }
    
    // 4. Initialize the app
    await loadDashboard();
    console.log('‚úÖ Family Hub ready!');
}

// ===== SAVE SETTINGS TO SHEETS ONLY =====
async function saveSettings() {
    const settings = {
        nannyName: document.getElementById('nannyName').value,
        hourlyRate: document.getElementById('hourlyRate').value,
        venmoUsername: document.getElementById('venmoUsername').value,
        yourName: CONFIG.yourName,
        partnerName: CONFIG.partnerName,
        familyPIN: CONFIG.familyPIN
    };
    
    // Save to Google Sheets (no localStorage!)
    const result = await callGoogleScript('saveSettings', settings);
    
    if (result && result.success) {
        // Update CONFIG with new values
        Object.assign(CONFIG, settings);
        alert('‚úÖ Settings saved to cloud! All users will see these changes.');
    } else {
        alert('Error saving settings');
    }
}

// ===== SIMPLIFIED COMPLETE SETUP =====
async function completeSetup() {
    const scriptUrl = document.getElementById('setupScriptUrl').value;
    const nannyName = document.getElementById('setupNannyName').value;
    const hourlyRate = document.getElementById('setupHourlyRate').value;
    const yourName = document.getElementById('setupYourName').value;
    const partnerName = document.getElementById('setupPartnerName').value;
    
    if (!scriptUrl || !nannyName) {
        alert('Please fill in required fields');
        return;
    }
    
    // For first setup, we need to hardcode the script URL
    alert('‚ö†Ô∏è IMPORTANT: You need to hardcode this Script URL in your index.html file on GitHub:\n\n' + scriptUrl);
    
    // Save settings to Google Sheets
    const settings = {
        nannyName: nannyName,
        hourlyRate: hourlyRate,
        yourName: yourName || 'Parent 1',
        partnerName: partnerName || 'Parent 2',
        scriptUrl: scriptUrl
    };
    
    CONFIG.scriptUrl = scriptUrl; // Temporarily set for this session
    
    const result = await callGoogleScript('saveSettings', settings);
    
    if (result && result.success) {
        const modal = document.querySelector('.modal-overlay');
        if (modal) modal.remove();
        
        alert('‚úÖ Setup complete! Settings saved to cloud.');
        location.reload();
    }
}

// ===== REPLACE DOMContentLoaded =====
document.addEventListener('DOMContentLoaded', () => {
    if (CONFIG.scriptUrl && CONFIG.scriptUrl !== 'https://script.google.com/macros/s/YOUR_ACTUAL_SCRIPT_ID_HERE/exec') {
        // Script URL is configured - initialize
        initializeApp();
    } else {
        // Script URL not configured
        alert('‚ö†Ô∏è App not configured!\n\n1. Edit index.html on GitHub\n2. Replace YOUR_ACTUAL_SCRIPT_ID_HERE with your Google Script ID\n3. Commit and push changes');
    }
});
        // ===== ROLE-BASED ACCESS CONTROL =====
        function checkAndInitializeRole() {
            // Check URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const role = urlParams.get('role');
            const setupKey = urlParams.get('setup');
            
            // Admin setup mode
            if (setupKey === 'admin123') {
                CONFIG.userRole = 'admin';
                localStorage.setItem('userRole', 'admin');
                return true;
            }
            
            // Check URL parameter role
            if (role === 'nanny' || role === 'family') {
                CONFIG.userRole = role;
                localStorage.setItem('userRole', role);
                return true;
            }
            
            // Check stored role
            const storedRole = localStorage.getItem('userRole');
            if (storedRole) {
                CONFIG.userRole = storedRole;
                return true;
            }
            
            // No role found - show selection
            return false;
        }
        
        function applyRoleRestrictions() {
            const role = CONFIG.userRole;
            console.log('Applying restrictions for role:', role);
            
            // Update user role display
            const roleDisplay = document.getElementById('userRoleDisplay');
            if (roleDisplay) {
                if (role === 'nanny') {
                    roleDisplay.textContent = 'üë∂ Logged in as: Nanny';
                } else if (role === 'family') {
                    roleDisplay.textContent = 'üë®‚Äçüë©‚Äçüëß Family Member';
                } else if (role === 'admin') {
                    roleDisplay.textContent = 'üîß Admin Mode';
                }
            }
            
            if (role === 'nanny') {
                // Hide tabs nanny shouldn't see
                const equityTab = document.querySelector('.equity-tab-btn');
                const settingsTab = document.querySelector('.settings-tab-btn');
                const scheduleTab = document.querySelector('.tab-btn:nth-child(2)');
                
                if (equityTab) equityTab.style.display = 'none';
                if (settingsTab) settingsTab.style.display = 'none';
                if (scheduleTab) scheduleTab.style.display = 'none';
                
                // Hide parent balance card
                const parentBalanceCard = document.querySelector('.parent-balance-card');
                if (parentBalanceCard) parentBalanceCard.style.display = 'none';
                
                // Hide payment button
                const familyOnlyElements = document.querySelectorAll('.family-only');
                familyOnlyElements.forEach(el => el.style.display = 'none');
            }
        }
        
        function showRoleSelection() {
            // Remove any existing modals
            const existingModal = document.querySelector('.modal-overlay');
            if (existingModal) existingModal.remove();
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            modal.innerHTML = `
                <div class="modal-content" style="text-align: center;">
                    <h2 style="color: #667eea; margin-bottom: 30px;">Welcome to Family Hub</h2>
                    <p style="margin-bottom: 30px; color: #666;">Please select who you are:</p>
                    
                    <button onclick="selectRole('family')" class="modal-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        üë®‚Äçüë©‚Äçüëß Family Member
                    </button>
                    
                    <button onclick="selectRole('nanny')" class="modal-btn" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                        üë∂ Nanny / Caregiver
                    </button>
                    
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                        <small style="color: #999;">First time setup? Contact your family for the setup link.</small>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function selectRole(role) {
            const modal = document.querySelector('.modal-overlay');
            
            if (role === 'family') {
                // Ask for family PIN
                const pin = prompt('Enter family PIN:');
                if (pin === CONFIG.familyPIN) {
                    CONFIG.userRole = 'family';
                    localStorage.setItem('userRole', 'family');
                    if (modal) modal.remove();
                    
                    // Check if setup is needed
                    if (!CONFIG.scriptUrl) {
                        showSetupWizard();
                    } else {
                        applyRoleRestrictions();
                        initializeFamilyHub();
                    }
                } else {
                    alert('Incorrect PIN');
                    return;
                }
            } else if (role === 'nanny') {
                CONFIG.userRole = 'nanny';
                localStorage.setItem('userRole', 'nanny');
                if (modal) modal.remove();
                
                // Check if app is configured
                if (!CONFIG.scriptUrl) {
                    alert('Please contact your employer for setup. The app is not yet configured.');
                    showRoleSelection();
                } else {
                    applyRoleRestrictions();
                    initializeFamilyHub();
                }
            }
        }
        
        // ===== SETUP WIZARD =====
        function showSetupWizard() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 style="color: #667eea; margin-bottom: 20px;">üöÄ Welcome to Family Hub!</h2>
                    <p style="margin-bottom: 20px;">Let's get you set up in 30 seconds:</p>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Step 1: Your Google Script URL
                        </label>
                        <input type="text" id="setupScriptUrl" placeholder="https://script.google.com/macros/s/..." 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 5px;">
                        <small style="color: #666;">This connects to your Google Sheet database</small>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Step 2: Nanny's Name
                        </label>
                        <input type="text" id="setupNannyName" placeholder="e.g., Sarah" 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Step 3: Hourly Rate ($)
                        </label>
                        <input type="number" id="setupHourlyRate" placeholder="20" value="20"
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">
                            Step 4: Your Names (Optional)
                        </label>
                        <input type="text" id="setupYourName" placeholder="Your name" 
                               style="width: 48%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-right: 2%;">
                        <input type="text" id="setupPartnerName" placeholder="Partner's name" 
                               style="width: 48%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    
                    <button onclick="completeSetup()" class="modal-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        Complete Setup
                    </button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f7fafc; border-radius: 8px;">
                        <p style="margin: 0; color: #666; font-size: 0.9em;">
                            <strong>Need your Script URL?</strong><br>
                            1. Open your Google Sheet<br>
                            2. Go to Extensions ‚Üí Apps Script<br>
                            3. Click Deploy ‚Üí Manage Deployments<br>
                            4. Copy the Web App URL
                        </p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function completeSetup() {
            const scriptUrl = document.getElementById('setupScriptUrl').value;
            const nannyName = document.getElementById('setupNannyName').value;
            const hourlyRate = document.getElementById('setupHourlyRate').value;
            const yourName = document.getElementById('setupYourName').value;
            const partnerName = document.getElementById('setupPartnerName').value;
            
            if (!scriptUrl) {
                alert('Please enter your Google Script URL');
                return;
            }
            
            if (!nannyName) {
                alert('Please enter your nanny\'s name');
                return;
            }
            
            // Save all settings
            localStorage.setItem('scriptUrl', scriptUrl);
            localStorage.setItem('nannyName', nannyName);
            localStorage.setItem('hourlyRate', hourlyRate || '20');
            localStorage.setItem('yourName', yourName || 'You');
            localStorage.setItem('partnerName', partnerName || 'Partner');
            
            // Update CONFIG
            CONFIG.scriptUrl = scriptUrl;
            CONFIG.nannyName = nannyName;
            CONFIG.hourlyRate = parseFloat(hourlyRate) || 20;
            CONFIG.yourName = yourName || 'You';
            CONFIG.partnerName = partnerName || 'Partner';
            
            // Remove modal
            const modal = document.querySelector('.modal-overlay');
            if (modal) modal.remove();
            
            alert('‚úÖ Setup complete! Welcome to Family Hub!');
            
            // Apply restrictions and initialize
            applyRoleRestrictions();
            initializeFamilyHub();
        }
        
        // ===== GOOGLE SHEETS INTEGRATION =====
async function callGoogleScript(action, params = {}) {
  if (!CONFIG.scriptUrl) {
    console.error('Script URL not configured');
    return null;
  }

  const url = new URL(CONFIG.scriptUrl);
  url.searchParams.append('action', action);
  Object.keys(params).forEach(k => url.searchParams.append(k, params[k]));
  url.searchParams.append('_ts', Date.now()); // cache-buster ‚úÖ

  try {
    const res = await fetch(url.toString()); // simple GET
    return await res.json();
  } catch (err) {
    console.error('Error calling script:', err);
    return null;
  }
}

        // ===== TAB MANAGEMENT =====
        function switchTab(tabName, event) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update nav
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Load data for the tab
            loadTabData(tabName);
        }
        
        async function loadTabData(tabName) {
            switch(tabName) {
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'nanny':
                    await loadNannyData();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        // ===== DASHBOARD FUNCTIONS =====
        async function loadDashboard() {
            console.log('Loading dashboard...');
        }
        
        // ===== NANNY TRACKER FUNCTIONS =====
        let timerInterval = null;
        let currentClockInTime = null;
        
        async function clockIn() {
            const result = await callGoogleScript('clockIn', {
                name: CONFIG.nannyName
            });
            
            if (result && result.success) {
                currentClockInTime = new Date(result.time);
                updateClockDisplay(true, currentClockInTime);
                startTimer();
                await loadNannyData();
            } else {
                alert('Error clocking in. Check that the Google Script is configured.');
            }
        }
        
        async function clockOut() {
            const result = await callGoogleScript('clockOut', {
                name: CONFIG.nannyName
            });
            
            if (result && result.success) {
                stopTimer();
                updateClockDisplay(false, null);
                alert(`‚úÖ Clocked out! Worked ${result.hours} hours today.`);
                await loadNannyData();
            } else {
                alert('Error clocking out. Please try again.');
            }
        }
        
        function updateClockDisplay(isClockedIn, clockInTime) {
            const clockInBtn = document.getElementById('clockInBtn');
            const clockOutBtn = document.getElementById('clockOutBtn');
            const clockInTimeDisplay = document.getElementById('clockInTime');
            const timerDisplay = document.getElementById('liveTimer');
            
            if (isClockedIn) {
                if (clockInBtn) clockInBtn.style.display = 'none';
                if (clockOutBtn) clockOutBtn.style.display = 'inline-block';
                if (clockInTimeDisplay && clockInTime) {
                    clockInTimeDisplay.textContent = `Clocked in at ${clockInTime.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    })}`;
                }
            } else {
                if (clockInBtn) clockInBtn.style.display = 'inline-block';
                if (clockOutBtn) clockOutBtn.style.display = 'none';
                if (clockInTimeDisplay) clockInTimeDisplay.textContent = 'Not clocked in';
                if (timerDisplay) timerDisplay.textContent = '00:00:00';
            }
        }
        
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                if (!currentClockInTime) return;
                
                const now = new Date();
                const diff = now - currentClockInTime;
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                const display = 
                    String(hours).padStart(2, '0') + ':' +
                    String(minutes).padStart(2, '0') + ':' +
                    String(seconds).padStart(2, '0');
                
                const timerElement = document.getElementById('liveTimer');
                if (timerElement) {
                    timerElement.textContent = display;
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            currentClockInTime = null;
        }
        async function loadJSON(action, params = {}) {
  const url = new URL(CONFIG.scriptUrl);
  url.searchParams.set('action', action);
  Object.entries(params).forEach(([k,v]) => url.searchParams.set(k, v));
  const res = await fetch(url);
  if (!res.ok) throw new Error(`Request failed: ${res.status}`);
  return res.json();
}
     async function loadNannyData() {
  // 1) Update clocked-in status + timer
  const status = await callGoogleScript('getCurrentStatus', { name: CONFIG.nannyName });
  if (status?.status === 'clocked_in') {
    currentClockInTime = new Date(status.since);
    updateClockDisplay(true, currentClockInTime);
    startTimer();
  } else {
    updateClockDisplay(false, null);
    stopTimer();
  }

  // 2) Get this week‚Äôs entries for THIS nanny
  const res = await callGoogleScript('getTimeEntries', { weekOnly: true, name: CONFIG.nannyName });
  const entries = res?.entries || [];

  // Only completed shifts (have a clockOut)
  const done = entries.filter(e => e.clockOut);

  // 3) Rebuild the summary table body
  const tbody = document.querySelector('#nanny-tab tbody');
  if (tbody) {
    tbody.innerHTML = '';
    for (const e of done) {
      const hours = parseFloat(e.hours) || 0;
      const pay = hours * (CONFIG.hourlyRate || 20);
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${new Date(e.date).toLocaleDateString()}</td>
        <td>${new Date(e.clockIn).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
        <td>${new Date(e.clockOut).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</td>
        <td>${hours.toFixed(1)}</td>
        <td>$${pay.toFixed(2)}</td>
        <td>${e.notes || ''}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  // 4) Update the big total banner
  const totalHours = done.reduce((sum, e) => sum + (parseFloat(e.hours) || 0), 0);
  const totalPay = totalHours * (CONFIG.hourlyRate || 20);
  const totalEl = document.getElementById('weeklyTotal');
  if (totalEl) totalEl.textContent = `Total: $${totalPay.toFixed(2)} (${totalHours.toFixed(1)} hours)`;
}


        // ===== SETTINGS FUNCTIONS =====
async function saveSettings() {
    const nannyName = document.getElementById('nannyName').value;
    const hourlyRate = document.getElementById('hourlyRate').value;
    const venmoRaw = document.getElementById('venmoUsername').value;
    
    const venmoClean = sanitizeVenmo(venmoRaw);
    
    // Save to Google Sheets for everyone
    const result = await callGoogleScript('saveSettings', {
        nannyName: nannyName,
        hourlyRate: hourlyRate,
        venmoUsername: venmoClean,
        yourName: CONFIG.yourName,
        partnerName: CONFIG.partnerName,
        scriptUrl: CONFIG.scriptUrl
    });
    
    if (result && result.success) {
        // Update local CONFIG
        CONFIG.nannyName = nannyName;
        CONFIG.hourlyRate = parseFloat(hourlyRate);
        CONFIG.venmoUsername = venmoClean;
        
        // Also update localStorage as backup
        localStorage.setItem('nannyName', nannyName);
        localStorage.setItem('hourlyRate', hourlyRate);
        localStorage.setItem('venmoUsername', venmoClean);
        
        document.getElementById('venmoUsername').value = venmoClean ? '@' + venmoClean : '';
        
        alert('Settings saved for all users!');
        await loadDashboard(); // Refresh with new settings
    } else {
        alert('Error saving settings to cloud. Using local save only.');
        // Fallback to local save
        localStorage.setItem('nannyName', nannyName);
        localStorage.setItem('hourlyRate', hourlyRate);
        localStorage.setItem('venmoUsername', venmoClean);
    }
}
        
        function loadSettings() {
            if (document.getElementById('nannyName')) {
                document.getElementById('nannyName').value = CONFIG.nannyName;
                document.getElementById('hourlyRate').value = CONFIG.hourlyRate;
                document.getElementById('venmoUsername').value = CONFIG.venmoUsername || '';
            }
            
            if (document.getElementById('scriptUrlSetting')) {
                document.getElementById('scriptUrlSetting').value = CONFIG.scriptUrl || '';
                document.getElementById('yourNameSetting').value = CONFIG.yourName || '';
                document.getElementById('partnerNameSetting').value = CONFIG.partnerName || '';
            }
        }
        
// ===== PAYMENT FUNCTIONS =====
async function generateVenmoPayment() {
  try {
    if (!CONFIG.scriptUrl) {
      alert('Google Script URL is not set. Add it in Settings.');
      return;
    }

    // 1) Read & validate Venmo handle
    const raw = (CONFIG.venmoUsername || '').trim();
    const handle = sanitizeVenmo(raw); // removes leading @

    // Block placeholder or empty handle
    if (!raw || /^@?username$/i.test(raw)) {
      alert('Set your real Venmo Username in Settings (e.g., @nickreitzin), then try again.');
      return;
    }

    // 2) Pull this week's entries for THIS nanny
    const rate = Number(CONFIG.hourlyRate) || 20;
    const res = await callGoogleScript('getTimeEntries', { weekOnly: true, name: CONFIG.nannyName });
    const entries = res?.entries || [];

    // only completed shifts
    const done = entries.filter(e => e.clockOut);
    const hours = done.reduce((sum, e) => sum + (parseFloat(e.hours) || 0), 0);

    if (!hours) {
      alert('No completed hours recorded this week.');
      return;
    }

    const total = +(hours * rate).toFixed(2);

    // 3) Build week-of label (Sunday 00:00)
    const d = new Date();
    const weekStart = new Date(d);
    weekStart.setDate(d.getDate() - d.getDay());
    weekStart.setHours(0, 0, 0, 0);

    const note =
`Weekly payment for ${CONFIG.nannyName}
Week of ${weekStart.toLocaleDateString()}
Hours: ${hours.toFixed(1)}
Rate: ${fmtUSD(rate)}/hour
Total: ${fmtUSD(total)}`;

    // 4) Mobile ‚Üí open Venmo app; else ‚Üí copy note
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

    if (isMobile && handle) {
      const venmoUrl =
        `venmo://paycharge?txn=pay&recipients=${encodeURIComponent(handle)}` +
        `&amount=${encodeURIComponent(total.toFixed(2))}` +
        `&note=${encodeURIComponent(note)}`;

      const ok = confirm(`Pay ${fmtUSD(total)} to @${handle} via Venmo?\n\nOK = open Venmo ¬∑ Cancel = copy details instead`);
      if (ok) {
        window.location.href = venmoUrl;
        return;
      }
      // fall through to copy
    }

    // Desktop or canceled: copy details
    try {
      await navigator.clipboard.writeText(note);
      alert(`‚úÖ Payment details copied to clipboard.\n\n${note}\n\nPaste into Venmo when sending.`);
    } catch {
      prompt('Copy this payment message:', note); // ultra-fallback
    }
  } catch (err) {
    console.error('generateVenmoPayment error:', err);
    alert('Could not generate the Venmo payment. Open the console for details.');
  }
}


        // ===== INITIALIZATION =====
async function initializeFamilyHub() {
    console.log('üöÄ Initializing Family Hub...');
    
    // First, try to load settings from Google Sheets
    const settings = await callGoogleScript('getSettings');
    
    if (settings && settings.configured) {
        // Apply settings from Sheets to everyone
        CONFIG.scriptUrl = settings.scriptUrl || CONFIG.scriptUrl;
        CONFIG.nannyName = settings.nannyName || CONFIG.nannyName;
        CONFIG.hourlyRate = parseFloat(settings.hourlyRate) || CONFIG.hourlyRate;
        CONFIG.yourName = settings.yourName || CONFIG.yourName;
        CONFIG.partnerName = settings.partnerName || CONFIG.partnerName;
        CONFIG.venmoUsername = settings.venmoUsername || CONFIG.venmoUsername;
        
        console.log('‚úÖ Loaded shared settings from Google Sheets');
    } else if (!CONFIG.scriptUrl) {
        console.log('No settings found in Sheets and no local config');
        if (CONFIG.userRole === 'admin' || CONFIG.userRole === 'family') {
            showSetupWizard();
            return;
        }
    }
    
    await loadDashboard();
    console.log('‚úÖ Family Hub ready!');
}
        // ===== MAIN ENTRY POINT =====
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user has a role
            const hasRole = checkAndInitializeRole();
            
            if (!hasRole) {
                // No role found - show selection
                showRoleSelection();
            } else {
                // Role exists - apply restrictions and check if setup is needed
                applyRoleRestrictions();
                
                if (!CONFIG.scriptUrl && CONFIG.userRole === 'family') {
                    showSetupWizard();
                } else if (!CONFIG.scriptUrl && CONFIG.userRole === 'nanny') {
                    alert('Please contact your employer for setup. The app is not yet configured.');
                    showRoleSelection();
                } else {
                    initializeFamilyHub();
                }
            }
        });
    </script>
</body>
</html>









